# 뉴스 수집 기능 수정 완료

## 수정 사항

### 1. Timeout 및 HTTP 200 체크 추가 ✅
- 모든 뉴스 소스(RSS) 요청에 `timeout=5초` 추가
- HTTP 상태 코드 200 체크 추가
- 200이 아닐 경우 오류 메시지 반환

### 2. 각 뉴스 소스별 개별 try/except 적용 ✅
- Google News, Yahoo Finance, Reuters, CNBC 각각 개별 try/except 블록
- 각 소스의 오류를 독립적으로 처리
- 실패한 소스 정보를 로그에 출력

### 3. 오류 상태 프론트로 전달 ✅
- `collect_news()` 반환값에 `sources_status` 추가
- 각 소스별 성공/실패 상태, 개수, 오류 메시지 포함
- 실패 시 오류 상태를 프론트엔드로 전달

### 4. JSON 형식 요구사항에 맞게 수정 ✅
- `published_date` → `published_at`으로 변경
- `sentiment` 구조를 `{pos, neu, neg}` 형식으로 변경
- `score` 필드 추가 (0~100 범위)
- 기존 형식 제거

### 5. 기본값 50 제거 ✅
- `calculate_sentiment_summary()`에서 기사 개수가 0일 때 `None` 반환
- 기본값 50으로 고정되던 부분 제거
- 프론트엔드에서 `None` 체크 후 "뉴스 수집 실패" 메시지 표시

### 6. 프론트엔드 오류 처리 개선 ✅
- 빈 리스트가 아닌 오류 상태 확인
- 소스별 실패 정보 표시
- 상세한 오류 메시지 토스트 표시
- "뉴스 수집 실패" UI 표시

### 7. CORS 설정 확인 ✅
- `backend/main.py`에서 CORS 미들웨어 설정 확인
- `allow_origins=["*"]` 설정으로 모든 Origin 허용
- GET 요청 정상 작동 확인

## 수정된 파일

### 백엔드
1. **backend/services/news_service.py**
   - 각 RSS 수집 함수에 timeout 및 HTTP 200 체크 추가
   - 반환값을 `(articles, error_message)` 튜플로 변경
   - `collect_news()` 반환값에 `sources_status` 추가
   - `get_latest_news()` JSON 형식 수정 (published_at, sentiment 구조)
   - `calculate_sentiment_summary()` 기본값 50 제거

2. **backend/routers/news.py**
   - `/collect` 엔드포인트 오류 상태 반환 추가
   - `/` 엔드포인트 JSON 형식 수정
   - 상세한 오류 로그 출력 추가

### 프론트엔드
1. **frontend/src/pages/NewsAnalysis.tsx**
   - API 응답 형식 변경에 맞춰 데이터 파싱 수정
   - 오류 처리 개선 (소스별 실패 정보 표시)
   - "뉴스 수집 실패" UI 표시
   - `sentiment` null 체크 추가

## API 응답 형식

### GET /news
```json
{
  "articles": [
    {
      "title": "",
      "summary": "",
      "published_at": "",
      "url": "",
      "sentiment": {
        "pos": 0.0,
        "neu": 0.0,
        "neg": 0.0
      },
      "score": 50
    }
  ],
  "sentiment_summary": null,  // 기사가 없으면 null
  "has_news": false
}
```

### GET /news/collect
```json
{
  "success": false,
  "message": "뉴스 수집 실패",
  "collected": 0,
  "processed": 0,
  "articles": [],
  "sources_status": {
    "google_news": {
      "success": false,
      "count": 0,
      "error": "Google News RSS 요청 시간 초과 (5초)"
    },
    "yahoo_finance": {
      "success": false,
      "count": 0,
      "error": "..."
    }
  },
  "error": "모든 뉴스 소스에서 뉴스를 가져오지 못했습니다"
}
```

## 테스트 방법

1. **서버 재시작**
   ```powershell
   cd backend
   python main.py
   ```

2. **API 호출 테스트**
   ```
   GET http://localhost:8000/news?limit=10
   GET http://localhost:8000/news/collect?max_results=10
   ```

3. **프론트엔드 테스트**
   - 뉴스 분석 페이지 접속
   - "뉴스 수집" 버튼 클릭
   - 소스별 상태 확인
   - 오류 메시지 확인

## 주의사항

1. **네트워크 연결**: RSS 피드 수집은 인터넷 연결이 필요합니다.
2. **Timeout**: 각 소스별 5초 timeout이 설정되어 있어 느린 네트워크에서는 실패할 수 있습니다.
3. **RSS 피드 변경**: 외부 RSS 피드 구조가 변경되면 파싱 로직 수정이 필요할 수 있습니다.

---

**작성일**: 2024년
**상태**: 수정 완료



