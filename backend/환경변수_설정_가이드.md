# 환경변수 설정 가이드 (무료 API 기반)

## .env 파일 설정

### 1. .env 파일 생성

`backend/.env` 파일을 생성하고 다음 내용을 추가하세요:

```env
# Marketaux API Key (뉴스 기능용, 선택사항)
MARKETAUX_API_KEY=your_marketaux_api_key_here
```

### 2. 파일 위치

```
backend/
  ├── .env          ← 여기에 생성
  ├── main.py
  ├── core/
  │   └── config.py
  └── ...
```

### 3. .env 파일 예시

```env
# Marketaux API Key (뉴스 기능용, 선택사항)
# 무료 플랜: 일일 100회 호출 제한
# 가입: https://www.marketaux.com/
# API KEY가 없으면 뉴스 기능이 자동으로 비활성화되고 빈 리스트를 반환합니다.
MARKETAUX_API_KEY=JmV7dvXddW1Ln892gmf89jHWGFzmPA8k7Md3sZ3l

# 기타 설정 (선택사항)
DATABASE_URL=sqlite:///./etf_advisor.db
HOST=0.0.0.0
PORT=8000
```

## API KEY 설정

### Marketaux API Key (선택사항)

- **용도**: 뉴스 데이터 수집
- **무료 플랜**: 일일 100회 호출 제한
- **가입**: https://www.marketaux.com/
- **설정 없을 때**: 
  - 뉴스 API는 자동으로 비활성화됩니다
  - `/news` 엔드포인트는 빈 리스트(`articles=[]`)를 반환합니다
  - 경고 메시지 없이 정상 작동합니다
  - 다른 기능(가격, 기술지표, FGI 등)은 정상 작동합니다

### Yahoo Finance (yfinance)

- **API Key 불필요**: Python 라이브러리로 직접 사용
- **제한**: 과도한 호출 시 일시적 제한 가능 (캐싱으로 완화)

### Fear & Greed Index

- **API Key 불필요**: CNN FGI Scraper 또는 Mirror API 사용
- **제한**: 무료 사용 가능

## 데이터 소스

### 1. 가격 데이터
- **소스**: Yahoo Finance (yfinance)
- **제공 데이터**: 일일 종가, 시가, 고가, 저가, 거래량
- **기간**: 최대 5년치 데이터 제공

### 2. 기술적 지표
- **계산 방식**: 서버에서 직접 계산 (pandas + numpy)
- **제공 지표**: MA, RSI, MACD, Stochastic, 변동성, MDD

### 3. 뉴스
- **소스**: Marketaux API (무료 플랜)
- **제한**: 일일 100회 호출

### 4. Fear & Greed Index
- **소스**: CNN FGI Scraper / Mirror API
- **제한**: 무료 사용 가능

## 캐싱

- **방식**: In-memory 캐싱
- **TTL**: 
  - 가격 데이터: 15분
  - 히스토리 데이터: 30분
  - 기술적 지표: 15분
  - 뉴스: 15분
  - FGI: 15분

## API 엔드포인트

### ETF 가격
- `GET /etf/{symbol}/price` - 최신 가격
- `GET /etf/{symbol}/history?years=3` - 히스토리

### 기술적 지표
- `GET /etf/{symbol}/ma?days=200` - 이동평균
- `GET /etf/{symbol}/rsi` - RSI
- `GET /etf/{symbol}/macd` - MACD
- `GET /etf/{symbol}/stochastic` - Stochastic
- `GET /etf/{symbol}/volatility?period=30` - 변동성
- `GET /etf/{symbol}/mdd` - MDD

### 시장 데이터
- `GET /market/fgi` - Fear & Greed Index
- `GET /market/sentiment?symbol=VIG` - 종합 센티먼트

### 뉴스
- `GET /news?symbol=VIG&limit=20` - 뉴스 목록

## 문제 해결

### 1. "MARKETAUX_API_KEY가 설정되지 않았습니다" 경고

**해결 방법:**
- 뉴스 기능만 제한되며 다른 기능은 정상 작동
- Marketaux API Key를 설정하면 뉴스 기능 사용 가능
- 또는 뉴스 없이도 Fear & Greed Index 기반 센티먼트 분석 가능

### 2. yfinance 데이터 가져오기 실패

**해결 방법:**
1. 인터넷 연결 확인
2. 심볼이 올바른지 확인 (VIG, QLD 등)
3. 잠시 후 재시도 (일시적 제한 가능)
4. 캐시가 있으면 캐시된 데이터 사용

### 3. Fear & Greed Index 가져오기 실패

**해결 방법:**
1. CNN API 또는 Mirror API 일시적 장애 가능
2. 자동으로 다른 소스로 재시도
3. 실패 시 -1 점수 반환 (프론트엔드에서 처리)

## 참고 사항

- `.env` 파일은 Git에 커밋하지 마세요 (보안)
- Marketaux API Key는 선택사항입니다
- 모든 데이터는 캐싱되어 API 호출을 최소화합니다
- 무료 API 기반이므로 호출 제한에 주의하세요

