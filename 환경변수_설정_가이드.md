# 환경변수 설정 가이드

## .env 파일 설정

### 1. .env 파일 생성

`backend/.env` 파일을 생성하고 다음 내용을 추가하세요:

```env
ALPHA_VANTAGE_API_KEY=M7IV5KOH5RXBKOQC
```

### 2. 파일 위치

```
backend/
  ├── .env          ← 여기에 생성
  ├── main.py
  ├── core/
  │   └── config.py
  └── ...
```

### 3. .env 파일 예시

```env
# Alpha Vantage API Key
ALPHA_VANTAGE_API_KEY=M7IV5KOH5RXBKOQC

# 기타 설정 (선택사항)
DATABASE_URL=sqlite:///./etf_advisor.db
HOST=0.0.0.0
PORT=8000
```

## API KEY 검증

### 1. 디버깅 엔드포인트

서버 실행 후 다음 엔드포인트로 API KEY 인식 여부를 확인할 수 있습니다:

```bash
GET http://localhost:8000/debug/env
```

응답 예시:
```json
{
  "ALPHA_VANTAGE_API_KEY": "M7IV5KOH5RXBKOQC",
  "ALPHA_VANTAGE_API_KEY_set": true,
  "settings.alpha_vantage_api_key": "M7IV5KOH5RXBKOQC",
  "env_file_exists": true
}
```

### 2. API KEY가 없을 때

API KEY가 설정되지 않았을 경우:
- `/debug/env` 엔드포인트에서 `ALPHA_VANTAGE_API_KEY_set: false` 반환
- `/etf/update` 엔드포인트에서 `success: false` 반환
- 프론트엔드에서 명확한 오류 메시지 표시

## ETF 데이터 업데이트

### 1. 모든 ETF 데이터 업데이트

```bash
POST http://localhost:8000/etf/update
```

응답 예시 (성공):
```json
{
  "success": true,
  "message": "ETF 데이터 업데이트 완료: 2/2개 성공",
  "results": [
    {"symbol": "VIG", "status": "success"},
    {"symbol": "QLD", "status": "success"}
  ]
}
```

응답 예시 (API KEY 없음):
```json
{
  "success": false,
  "message": "ALPHA_VANTAGE_API_KEY가 설정되지 않았습니다. .env 파일에 ALPHA_VANTAGE_API_KEY를 추가하세요.",
  "error": "API_KEY_NOT_SET",
  "results": []
}
```

### 2. 개별 ETF 데이터 업데이트

```bash
POST http://localhost:8000/etf/VIG/update
POST http://localhost:8000/etf/QLD/update
```

## CSV 캐시 위치

ETF 데이터는 다음 경로에 CSV 파일로 저장됩니다:

```
backend/
  └── data/
      └── etf/
          ├── VIG.csv
          └── QLD.csv
```

## 문제 해결

### 1. "ALPHA_VANTAGE_API_KEY가 설정되지 않았습니다" 오류

**해결 방법:**
1. `backend/.env` 파일이 존재하는지 확인
2. `.env` 파일에 `ALPHA_VANTAGE_API_KEY=M7IV5KOH5RXBKOQC` 추가
3. 서버 재시작
4. `/debug/env` 엔드포인트로 확인

### 2. API KEY가 인식되지 않음

**해결 방법:**
1. `.env` 파일이 `backend/.env` 경로에 있는지 확인
2. `.env` 파일의 인코딩이 UTF-8인지 확인
3. `.env` 파일에 빈 줄이나 특수 문자 확인
4. `config.py`에서 환경변수 로드 로직 확인

### 3. CSV 파일이 생성되지 않음

**해결 방법:**
1. `backend/data/etf/` 디렉토리 권한 확인
2. `/etf/update` 엔드포인트 호출 후 오류 메시지 확인
3. 서버 로그에서 CSV 저장 오류 확인

## 참고 사항

- `.env` 파일은 Git에 커밋하지 마세요 (보안)
- API KEY는 환경변수로 관리하는 것을 권장합니다
- Alpha Vantage 무료 플랜: 분당 5회, 일일 500회 제한


