# CNN Fear & Greed Index 실시간 스크래핑 기능 완전 구현

## ✅ 구현 완료 사항

### 1. CNN 실시간 스크래핑
- ✅ CNN 페이지 (https://edition.cnn.com/markets/fear-and-greed)에서 실시간 스크래핑
- ✅ 수치 (0~100) 자동 추출
- ✅ 상태명 자동 추출 (Extreme Fear, Fear, Neutral, Greed, Extreme Greed)
- ✅ BeautifulSoup 기반 HTML 파싱
- ✅ 여러 파싱 방법 시도 (안정성 향상)

### 2. 백엔드 API
- ✅ `GET /market/fear-greed` - CNN FGI 조회 (변화율, 트리거 신호 포함)
- ✅ `force_refresh` 파라미터로 강제 새로고침 지원
- ✅ 15분 캐싱 (메모리 기반)
- ✅ 네트워크 오류·구조 변경 예외 처리
- ✅ API 백업 (Alternative.me API)

### 3. FGI 변화율 계산
- ✅ 전일 대비 변화량 (change)
- ✅ 전일 대비 변화율 (change_rate, %)
- ✅ 이전 값 저장 및 조회
- ✅ 변화율 기반 트리거 신호 생성

### 4. 트리거 신호 알고리즘
- ✅ FGI 0~40: "공포 구간 - QLD 매수 신호 강화 가능성"
- ✅ FGI 60~100: "탐욕 구간 - VIG 유지/매수 권장, QLD 비중 축소"
- ✅ FGI 40~60: "중립 구간 - 기술지표(RSI/MA200) 기반 판단 권장"
- ✅ 공포 구간 반등 (15→20): "공포 구간 반등 시작 → QLD 진입 신뢰도↑"
- ✅ 탐욕 구간 약화 (75→68): "탐욕 구간 약화 → VIG 유지 신뢰도↑"
- ✅ 급격한 변화 감지 (변화량 ≥10)

### 5. 스위칭 알고리즘 통합
- ✅ FGI 0~40 (공포·극공포): QLD 매수 신호 강화
  - QLD 보유 시: 유지 또는 추가 매수
  - VIG 보유 시: QLD로 스위칭 고려 (기술지표 양호 시)
  
- ✅ FGI 60~100 (탐욕·극탐욕): VIG 매수 신호 강화, QLD 비중 축소
  - VIG 보유 시: 유지 강화
  - QLD 보유 시: VIG로 스위칭 고려
  
- ✅ FGI 40~60 (중립): 기술지표(RSI/MA200) 기반 판단 유지

- ✅ 트리거 신호 기반 신뢰도 조정
- ✅ 행동 가이드 자동 생성

### 6. 프론트엔드 통합
- ✅ **대시보드**: FGI 카드에 변화율, 행동 가이드 표시
- ✅ **시장 심리 페이지**: FGI 상세 정보, 트리거 신호, 행동 가이드
- ✅ **스위칭 시그널 페이지**: FGI 값, 변화율, 트리거 신호 표시
- ✅ 한국어 상태명 표시
- ✅ 색상 기반 시각화

### 7. 포트폴리오 비중 추천 통합
- ✅ FGI 0~40: QLD 점수 +20~30, VIG 점수 -10~15
- ✅ FGI 60~100: VIG 점수 +20~30, QLD 점수 -15
- ✅ FGI 40~60: 기술지표 기반 판단
- ✅ 변화율 반영: 공포 구간 반등 시 QLD 점수 +5, 탐욕 구간 약화 시 VIG 점수 +5

## 📊 API 응답 구조

### GET /market/fear-greed
```json
{
  "date": "2024-01-01T12:00:00",
  "value": 45,
  "classification": "Fear",
  "change": 5,
  "change_rate": 12.5,
  "previous_value": 40,
  "trigger_signals": [
    "공포 구간 - QLD 매수 신호 강화 가능성",
    "공포 구간 반등 시작 (40→45) → QLD 진입 신뢰도↑"
  ],
  "confidence_boost": 0.1,
  "action_guide": "공포 구간 반등 시작 (40→45) → QLD 진입 신뢰도↑"
}
```

## 🔧 스위칭 알고리즘 로직

### FGI 기반 판단 규칙

1. **공포 구간 (FGI 0~40)**
   - **QLD 보유 시**: 
     - 액션: 유지 또는 추가 매수 (RSI < 70 기준)
     - 신뢰도: 0.85 ~ 0.95
     - 이유: "공포 구간(FGI: X) - QLD 매수 신호 강화"
   
   - **VIG 보유 시**: 
     - 액션: QLD로 스위칭 고려 (기술지표 양호 시)
     - 신뢰도: 0.8 + (40 - FGI) / 200
     - 이유: "공포 구간(FGI: X)에서 QLD 매수 신호. QLD 기술지표 양호."

2. **탐욕 구간 (FGI 60~100)**
   - **VIG 보유 시**: 
     - 액션: 유지 강화
     - 신뢰도: 0.85 + (FGI - 60) / 200
     - 이유: "탐욕 구간(FGI: X) - VIG 유지 권장, QLD 비중 축소"
   
   - **QLD 보유 시**: 
     - 액션: VIG로 스위칭 고려
     - 신뢰도: 0.75 + (FGI - 60) / 200
     - 이유: "탐욕 구간(FGI: X)에서 방어적 전환. VIG 비중 확대 권장."

3. **중립 구간 (FGI 40~60)**
   - 기술지표(RSI/MA200) 기반 판단 유지
   - 모멘텀 강화 시 QLD 스위칭 고려

### 트리거 신호 예시

1. **공포 구간 반등**: 
   - 15→20 상승: "공포 구간 반등 시작 (15→20) → QLD 진입 신뢰도↑"
   - 신뢰도 향상: +0.1

2. **탐욕 구간 약화**: 
   - 75→68 하락: "탐욕 구간 약화 (75→68) → VIG 유지 신뢰도↑"
   - 신뢰도 향상: +0.1

3. **급격한 변화**: 
   - 변화량 ≥10: "FGI 급변 (X→Y, ±Z) → 시장 심리 변화"
   - 경고 메시지 생성

## 🎯 포트폴리오 비중 추천 반영

### FGI 기반 점수 조정

- **공포 구간 (0~40)**: 
  - QLD 점수 +20~30
  - VIG 점수 -10~15
  - 극공포 (0~25) 시 추가 +10

- **탐욕 구간 (60~100)**: 
  - VIG 점수 +20~30
  - QLD 점수 -15
  - 극탐욕 (75~100) 시 추가 +10

- **중립 구간 (40~60)**: 
  - 기술지표 기반 판단

### 변화율 반영

- **공포 구간 반등 시작**: QLD 점수 +5
- **탐욕 구간 약화**: VIG 점수 +5

## 🚀 사용 방법

### 1. FGI 새로고침 (캐시 무시)
```
GET /market/fear-greed?force_refresh=true
```

### 2. 일반 조회 (캐시 사용, 15분)
```
GET /market/fear-greed
```

## 📝 한국어 상태명 매핑

- **Extreme Fear** → 극공포
- **Fear** → 공포
- **Neutral** → 중립
- **Greed** → 탐욕
- **Extreme Greed** → 극탐욕

## 🔍 안정성 기능

1. **15분 캐싱**: 과도한 요청 방지
2. **예외 처리**: 네트워크 오류, 구조 변경 대응
3. **백업 API**: CNN 실패 시 Alternative.me API 사용
4. **다중 파싱 방법**: 여러 방법으로 데이터 추출 시도

## ✨ 통합 완료

- ✅ 대시보드: FGI 위젯 개선 (변화율, 행동 가이드)
- ✅ 시장 심리 페이지: FGI 상세 정보, 트리거 신호
- ✅ 스위칭 시그널 페이지: FGI 정보 표시
- ✅ 스위칭 알고리즘: FGI 기반 로직 통합
- ✅ 포트폴리오 추천: FGI 기반 점수 조정
- ✅ 모든 텍스트: 한국어 출력

## 📦 필요한 패키지

백엔드 `requirements.txt`에 추가된 패키지:
- beautifulsoup4==4.12.2
- requests-html==0.10.0 (선택)

기존 패키지:
- requests==2.31.0
- lxml==5.1.0

## 🎉 최종 상태

**CNN Fear & Greed Index 실시간 스크래핑 기능이 완전히 구현되었습니다!**

- ✅ CNN 페이지에서 실시간 스크래핑
- ✅ FGI 변화율 계산 및 트리거 신호
- ✅ 스위칭 알고리즘에 완전 통합
- ✅ 프론트엔드 모든 페이지에 연동
- ✅ 한국어 출력
- ✅ 안정적인 캐싱 및 예외 처리

---

**구현 완료일**: 2024년
**상태**: ✅ 완전 구현 완료



